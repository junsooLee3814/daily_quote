name: daily_quote
on:
  schedule:
    - cron: '50 9 * * *'
  workflow_dispatch:

jobs:
  generate_groval_news_video:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: ğŸ¬ FFmpeg ì„¤ì¹˜ (ë™ì˜ìƒ ì œì‘ìš©)
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg

      - name: ğŸ“¦ Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install -r requirements.txt

      - name: ğŸ” í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GOOGLE_SERVICE_ACCOUNT: ${{ secrets.GOOGLE_SERVICE_ACCOUNT }}
        run: |
          if [ -z "$OPENAI_API_KEY" ]; then
            echo "âŒ OPENAI_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!"
            exit 1
          fi
          echo "OPENAI_API_KEY=$OPENAI_API_KEY" >> .env

          if [ -z "$GOOGLE_SERVICE_ACCOUNT" ]; then
            echo "âŒ GOOGLE_SERVICE_ACCOUNTê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!"
            exit 1
          fi
          echo "$GOOGLE_SERVICE_ACCOUNT" > google_service_account.json

          echo "âœ… í™˜ê²½ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ"

      - name: ğŸ¯ ê¸€ë¡œë²Œ ë‰´ìŠ¤ ë™ì˜ìƒ ìƒì„± ì‹¤í–‰
        run: |
          python gloval_news_video_make.py

      - name: ğŸ“¤ ìƒì„±ëœ íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add news_video/merged_news_bgm.mp4
          if git diff --staged --quiet; then
            echo "ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
          else
            git commit -m "ğŸ¬ ìë™ ìƒì„±: $(date '+%Y-%m-%d %H:%M') ê¸€ë¡œë²Œ ë‰´ìŠ¤ ë™ì˜ìƒ"
            git push
          fi
